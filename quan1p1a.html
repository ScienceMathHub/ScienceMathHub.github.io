<!--
------------------------------------------------------------------------
 量子力学(quantum mechanics) s軌道の存在確率

 HTML(JavaScript, canvas)

 key1-9,0,-,^, z,x,c, q,w,enter

 (c)Ohtani 2023.6
------------------------------------------------------------------------
-->
<!DOctxYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>量子力学(s軌道)</title>
</head>
<body>
<p id="quantum"></p>
<div style='float:left;'>
<input type="button" id = "but_1" value="Obital  1s" onclick="push(1)">
<pre></pre>
<input type="button" id = "but_2" value="Obital  2s" onclick="push(2)">
<pre></pre>
<input type="button" id = "but_3" value="Obital  3s" onclick="push(3)">
<pre></pre>
<input type="button" id = "but_4" value="Obital  4s" onclick="push(4)">
<pre></pre>
<input type="button" id = "but_5" value="Obital  5s" onclick="push(5)">
<pre></pre>
<input type="button" id = "but_6" value="Obital  6s" onclick="push(6)">
<pre></pre>
<input type="button" id = "but_7" value="Obital  7s" onclick="push(7)">
<pre></pre>
<input type="button" id = "but_8" value="Obital  8s" onclick="push(8)">
<pre></pre>
<input type="button" id = "but_9" value="Obital  9s" onclick="push(9)">
<pre></pre>
<input type="button" id = "but_0" value="Obital 10s" onclick="push(10)">
<pre></pre>
<script>
'use strict'

//----------------------------------------------------------------------
// canvas
//----------------------------------------------------------------------
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
document.body.appendChild(canvas);

//----------------------------------------------------------------------
// public variable
//----------------------------------------------------------------------
var WinX, WinY, WinW, WinH; // Window座標
var PosX, PosY;   // グラフィックカレント
var LocX, LocY;   // テキストカレント
var LocW, LocH;   // テキストMサイズ
var OffW, OffH;   // テキストSサイズ
var Zoom;         // 拡大率×(16,9)
var Width;        // 線幅
var Width0  =  2; // 線幅初期値
//---
var PI   = Math.PI;
var H    = 6.62607015E-34;       // プランク定数(J･s)
var Hd   = H / (2 * PI);         // ディラック定数
var Me   = 9.1093837015E-31;     // 電子の質量(kg)
var e    = 1.602176634E-19;      // 電子の電荷(C) [1eV(J)]
var e0   = 8.8541878128E-12;     // 真空中の誘電率(F/m) [(F)=(C/V)]
var Z    = 1;                    // 原子番号
var Atom = "H";                  // 元素記号
//---
var k    = 1 / (4 * PI * e0);    // 静電気力の比例定数
var a0   = (Hd*Hd) / (Me*k*e*e); // ボーア半径A0
var a    = a0 / Z;               // ボーア半径A0/Z
//---
var Px =  10;        // 表示位置x
var Py = 382;        // 表示位置y
var Fw = 620;        // 幅
var Fh = 320;        // 高さ
var Dh =   6;        // 高さ分割
var Zh = 100;        // 高さ拡大
var Co = '#00f';     // 色(目盛)
var Cp = '#0ff';     // 色(存在確率軸)
var Cr = '#f0f';     // 色(動径軸)
//---
var Dw = 80;         // 幅等分
var Dp = Dw*2;       // 幅等分(積分用)
//---
var Select  =  1; // 量子数n
var Selects = 10; // 量子数n最大
var isDisp  =  1; // 表示スイッチ

//----------------------------------------------------------------------
// touch
//----------------------------------------------------------------------
function push(n)
{ Select = n; window.requestAnimationFrame(main); }

function blur()
{
  document.getElementById("but_1" ).blur();
  document.getElementById("but_2" ).blur();
  document.getElementById("but_3" ).blur();
  document.getElementById("but_4" ).blur();
  document.getElementById("but_5" ).blur();
  document.getElementById("but_6" ).blur();
  document.getElementById("but_7" ).blur();
  document.getElementById("but_8" ).blur();
  document.getElementById("but_9" ).blur();
  document.getElementById("but_0" ).blur();
}

//----------------------------------------------------------------------
// 描画関数
//----------------------------------------------------------------------
function scrX(x)
{
  return Math.round((x - WinX) * canvas.width  / WinW);
}

function scrY(y)
{
  return Math.round((y - WinY) * canvas.height / WinH);
}

function WINDOW(x1, y1, x2, y2)
{
  WinX = x1;
  WinY = y1;
  WinW = x2 - x1 + 1;
  WinH = y2 - y1 + 1;
}

function LOCATE(x, y)
{
  LocX = x * LocW;
  LocY = y * LocH;
}

function CR()
{
  LocX = 0;
  LocY += LocH;
}

function CLS(c)
{
  ctx.fillStyle = c;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  LOCATE(0, 0);
}

function COLOR(c)
{
  ctx.fillStyle   = c;
  ctx.strokeStyle = c;
}

String.prototype.bytes = function ()
{
  return(encodeURIComponent(this).replace(/%../g,"x").length);
}

function FONT(zoom, offs)
{
  var h;

  zoom = Math.round(Zoom * zoom / 40 * 8);
  LocW = zoom;
  h    = zoom * 2;
  offs = Math.round(Zoom * offs / 40 * 8);
  OffH = offs * 2;
  offs = Math.round(Zoom        / 40 * 8);
  LocH = offs * 2;
  ctx.font = h + "px 'ＭＳ ゴシック'";  
}

function PRINT(text)
{
  var len, b;

  text += '';
  ctx.fillText(text, LocX, LocY + OffH  - 1);
  LocX += ctx.measureText(text).width;
/*
  b     = text.bytes();
  len   = text.length;
  b    -= len;
  b     = b / 2;
  len  += b;
  ctx.fillText(text, LocX, LocY + OffH  - 1);
  LocX += len * LocW;
*/
}

function SYMBOL(x, y, text, c)
{
  var x1, y1;

  x1 = scrX(x);
  y1 = scrY(y);
  ctx.fillStyle   = c;
  ctx.strokeStyle = c;
  ctx.fillText(text, x1, y1);
}

function POINT(x, y)
{
  PosX = scrX(x);
  PosY = scrY(y);
}

function LINE(x1, y1, x2, y2, c)
{
  ctx.strokeStyle = c;
  ctx.beginPath();
  PosX = scrX(x1);
  PosY = scrY(y1);
  ctx.moveTo(PosX, PosY);
  PosX = scrX(x2);
  PosY = scrY(y2);
  ctx.lineTo(PosX, PosY);
  ctx.stroke();
  ctx.closePath();
}

function LINE2(x2, y2, c)
{
  ctx.strokeStyle = c;
  ctx.beginPath();
  ctx.moveTo(PosX, PosY);
  PosX = scrX(x2);
  PosY = scrY(y2);
  ctx.lineTo(PosX, PosY);
  ctx.stroke();
  ctx.closePath();
}

function LINEB(x1, y1, x2, y2, c)
{
  LINE(x1, y1, x1, y2, c);
  LINE(x2, y1, x2, y2, c);
  LINE(x1, y1, x2, y1, c);
  LINE(x1, y2, x2, y2, c);
}
/*
function LINEB(x1, y1, x2, y2, c)
{
  var x, y, w, h;

  x = scrX(x1);
  y = scrY(y1);
  PosX = scrX(x2);
  PosY = scrY(y2);
  w = PosX - x + 1;
  h = PosY - y + 1;
  ctx.strokeStyle = c;
  ctx.strokeRect(x, y, w, h);
}
*/

function LINEBF(x1, y1, x2, y2, c)
{
  var x, y, w, h;

  x = scrX(x1);
  y = scrY(y1);
  PosX = scrX(x2);
  PosY = scrY(y2);
  w = PosX - x + 1;
  h = PosY - y + 1;
  ctx.fillStyle = c;
  ctx.fillRect(x, y, w, h);
}

//----------------------------------------------------------------------
// 指数
//----------------------------------------------------------------------
function PRINTe(s)
{
  var i, n, pow, num, a, p;

  s = String(s);
  p = 0;
  num = pow = 0;
  n = s.length;
  for (i = 0; i < n; i++)
  {
    a = s.substring(i, i+1);
    if (a == '^')
    {
      i++;
      a = s.substring(i, i+1);
      FONT(0.7, -0.3);
      PRINT(a);
      FONT(1, 0);
      continue;
    }
    if (a == '_')
    {
      i++;
      a = s.substring(i, i+1);
      FONT(0.7, 0.0);
      PRINT(a);
      FONT(1, 0);
      continue;
    }
    if (num && (a == 'e' || a == 'E'))
    {
      pow = 1;
      PRINT("x10");
      FONT(0.7, -0.4);
      continue;
    }
    num = ('0' <= a && a <= '9' || a == '-' || a== '+')? 1 : 0;
    if (pow && !num)
    {
      pow = 0;
      FONT(1, 0);
    }
    if (pow)
    {
      if (a != '+') { PRINT(a); p++; }
      continue;
    }
    PRINT(a);
  }
  FONT(1, 0);
  return p;
}

//----------------------------------------------------------------------
// Line width
//----------------------------------------------------------------------
function lineWidth(times)
{
  if (times == 1) { Width = Width0; }
  else
  {
    Width *= times;
    if      (Width <  1) Width =  1;
    else if (Width > 16) Width = 16;
  }
}

//----------------------------------------------------------------------
// Zoom
//----------------------------------------------------------------------
function zooming(sign)
{
  if (sign == 0) { Zoom = 40; }
  else
  {
    Zoom += sign * 5;
    if      (Zoom <  20) Zoom =  20;
    else if (Zoom > 120) Zoom = 120;
  }
  canvas.width  = 16 * Zoom;
  canvas.height =  9 * Zoom;

  FONT(1, 0);
}

//----------------------------------------------------------------------
// Axis and grid
//----------------------------------------------------------------------
function axis()
{
  var i, x, y;

  LINE(0, 0, 0, -Fh, Cp);
  LINE(0, 0, Fw,  0, Cr);

  for (i = 1; i <= Dw; i++)
  {
    x = i * Fw / Dw;
    LINE(x,  0, x, -Fh, Co);
  }
  for (i = 1; i <= Dh; i++)
  {
    y = i * Fh / Dh;
    LINE(0, -y, Fw, -y, Co);
  }
}

//----------------------------------------------------------------------
// En
//----------------------------------------------------------------------
function Energy(n)
{
  var E;

  E = k*Z*e*e/(n*Hd);
  E = (-Me/2) * E * E;
  return E;
}

//----------------------------------------------------------------------
// Factorial(n)
//----------------------------------------------------------------------
function Fact(n)
{
  var f, i;

  f = 1;
  for (i = 2; i <= n; i++)
  {
    f *= i;
  }
  return f;
}

//----------------------------------------------------------------------
// Pn(r, a)
//----------------------------------------------------------------------
function P(n, r, a)
{
  var p, m, s, ra2, fm, fm1, fnm1;

  ra2 = 2 * r / (n * a);
  p = 0;
  for (m = 0; m <= n-1; m++)
  {
    fm   = Fact(m);
    fm1  = Fact(m - 1);
    fnm1 = Fact(n - m - 1);
    s = Math.pow(-ra2, m);
    s = s / fm / fm1 / fnm1;
    p += s;
  }
  p *= ra2;
  p = p * p * Math.exp(-ra2);
  return p;
}

//----------------------------------------------------------------------
// probability graph(n, color)
//----------------------------------------------------------------------
function Graph(n, c)
{
  var dr, s, r, p, x, y;

  p  = Math.ceil(n / 6) * 5;  // floor
  p  = Math.pow(p, 1.5) * 7;  // 幅等分
  Dp = p * 2;                 // 幅等分(積分用)

  dr = 0.1;
  s = 0;
  for (r = 0; r <= Dp; r += dr)
  {
    p = P(n, r, 1) * dr;
    s += p;
  }

  POINT(0, 0);
  for (r = 0; r <= Dw; r += dr)
  {
    p = P(n, r, 1) * dr;
    p /= s;
    x = r * Fw / Dw
    y = p * Fh / Dh * Zh
    LINE2(x, -y, c);
  }
}

//----------------------------------------------------------------------
// (n)s
//----------------------------------------------------------------------
function Quan(n)
{ //           1   2   3   4   5   6    7    8    9   10
  var nDw = [ 16, 20, 24, 40, 60, 90, 120, 160, 200, 220];

  var E, f, i, c;

  Dh =   6;  // 高さ分割
  Zh = 100;  // 高さ拡大

  if (isDisp)
  {
    Dw = nDw[n-1];              // 幅等分
  }
  else
  {
    i  = Math.ceil(n / 6) * 5;  // floor
    Dw = Math.pow(i, 1.5) * 7;  // 幅等分
    Dw = Math.round(Dw);
  }

  CLS('#000');
  WINDOW(-Px, -Py, 639 - Px, 399 - Py);

  COLOR('#0f0');
  FONT(1,0);
  LOCATE(0, 1);
  i = (Selects > 9)? 0 : Selects;
  PRINT("Key1～" + i + ":量子数n  ");
  PRINT("(-,^,Enter,zxc,qw:可変,固定,初期化,画面サイズ,線幅)");
  COLOR('#fff');
  LOCATE(0, 2);
  PRINT(Atom + '原子 (' + n + 's): ');
  E = Energy(n);
  f = E / e;
  PRINTe('E = ' + E.toPrecision(7) + ' J ');
  PRINTe('( ' + f.toPrecision(7) + ' eV )');
  COLOR('#f0f');
  LOCATE(0, 3);
  COLOR('#0ff');
  PRINT('P(r/a)');
  COLOR('#fff');
  PRINT(' … ');
  COLOR('#f0f');
  PRINTe('a = ' + a.toPrecision(7) + ' m ');
  f = a * 1e+9;
  PRINTe('( ' + f.toPrecision(7) + ' nm )');
  PRINT(' Scale r/a = 0, 1, … , ' + Dw.toFixed(0));
  COLOR('#fff');
  LOCATE(0, 4);

  c = '#00f';
  for (i = 1; i <= Selects; i++)
  {
    if (i != n) Graph(i, c);
  }
  axis();
  c = '#ff0';
  Graph(n, c);
}

//----------------------------------------------------------------------
// Input key
//----------------------------------------------------------------------
document.body.addEventListener('keydown', event =>
{
  var key;

  switch (event.keyCode)
  {
    case  13: lineWidth( 1  ); isDisp = 1; blur(); break; // Enter
    case  81: lineWidth( 0.5); blur(); break; // 'Q'
    case  87: lineWidth( 2  ); blur(); break; // 'W'
    case  90: zooming  (-1  ); blur(); break; // 'Z'
    case  88: zooming  ( 1  ); blur(); break; // 'X'
    case  67: zooming  ( 0  ); blur(); break; // 'C'
    case  48: Select = 10    ; blur(); break; // '0'
    case 222:      isDisp = 0; blur(); break; // '^'
    case 189:      isDisp = 1; blur(); break; // '-'
//    case 220:      isDisp = 0; blur(); break; // '|'
    default :
    {
      key = event.keyCode - 48;
      if (1 <= key && key <= 9)
      {
        Select = key;
//        isDisp = 1;
        blur();
      }
    }
  }
  if (Select > Selects) Select = Selects;
  window.requestAnimationFrame(main);
});

//----------------------------------------------------------------------
// Key status
//----------------------------------------------------------------------
var Key = new Array(256);
for (var i = 0; i < 256; i++) Key[i] = 0;
window.onkeydown = function(event) { Key[event.keyCode] = 1; }
window.onkeyup   = function(event) { Key[event.keyCode] = 0; }

//----------------------------------------------------------------------
// main
//----------------------------------------------------------------------
function main()
{
  ctx.lineWidth = Width;
  Quan(Select);
//  window.requestAnimationFrame(main);
}

lineWidth(1);
zooming(0);
main();

//----------------------------------------------------------------------
</script>
</body>
</html>
